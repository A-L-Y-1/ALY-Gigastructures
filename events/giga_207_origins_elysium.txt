namespace = giga_elysium_origin

### Game Start
country_event = {
	id = giga_elysium_origin.001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = origin_elysium
	}

	immediate = {
		# Gives starting technologies
		give_technology = { tech = giga_tech_orbital_elysium message = no }

		# spawn elysium
		capital_scope = {
			solar_system = {
				# create origin platform
				spawn_megastructure = {
					type = orbital_elysium_origin_platform_0
					planet = prev
					owner = root
					graphical_culture = root
				}
				# immediately upgrade it to fire its effects
				random_system_megastructure = {
					limit = {
						is_megastructure_type = orbital_elysium_origin_platform_0
					}
					set_megastructure_flag = origin_elysium
					upgrade_megastructure_to = orbital_elysium_0
					finish_upgrade = yes
				}
			}

			# finish the colony and set capital scope
			random_moon = {
				limit = {
					is_planet_class = pc_giga_elysium
				}
				destroy_colony = yes
				giga_get_species_for_colony = {
					TARGET = this
					WHO = root
				}
				create_colony = {
					owner = root
					species = event_target:giga_colony_species
				}
				add_district = district_giga_elysium_housing
				add_district = district_giga_elysium_control
				add_district = district_giga_elysium_science
				set_capital = yes
				save_event_target_as = giga_elysium

				# populate the elysium
				while = {
					count = 4
					create_pop = {
						species = event_target:giga_colony_species
					}
				}

				if = {
					limit = {
						root = {
							is_hive_empire = yes
						}
					}
					add_building = building_spawning_pool
				}
				else_if = {
					limit = {
						root = {
							is_machine_empire = yes
						}
					}
					add_building = building_machine_assembly_plant
				}
			}

			# adjust capital
			set_update_modifiers_batch = begin

			set_colony_type = col_industrial
			while = {
				count = 3
				limit = {
					has_district = district_mining
				}
				remove_district = district_mining
				add_district = district_industrial
			}
			if = {
				limit = {
					num_districts = {
						type = district_industrial
						value > 1
					}
				}
				remove_district = district_industrial
			}
			if = {
				limit = {
					root = { is_gestalt = no }
				}
				while = {
					limit = {
						has_district = district_generator
					}
					remove_district = district_generator
					add_district = district_city
				}
			}

			validate_planet_buildings_and_districts = yes

			# update stability etc
			root = {
				country_event = {
					id = giga_elysium.100
				}
			}

			# temporarily boot some miners
			add_modifier = {
				modifier = giga_elysium_origin_fix
			}

			# make sure unemployed are fixed by demoting
			every_owned_pop = {
				#unemploy_pop = yes
				clear_pop_category = yes
			}

			# hopefully force an update
			set_update_modifiers_batch = end

			# shuffle pops back into jobs
			while = {
				count = 10
				check_planet_employment = yes
			}

			# clear fix modifier
			remove_modifier = giga_elysium_origin_fix
		}
	}
}
