gigas_habitat_cap_count_habitats = {
	set_variable = { which = habitat_count value = 0 }
	every_owned_planet = {
		limit = {
			OR = {
				is_planet_class = pc_habitat
				is_planet_class = pc_gigaorbital_ring
			}
		}
		from = {
			change_variable = { which = habitat_count value = 1 }
		}
	}
}

gigas_habitat_cap_pop_counting = {
    set_variable = { which = owned_pops value = 0 }
	every_owned_planet = {
		random_list = {
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 1 } }
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 31 } }
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 61 } }
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 91 } }
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 121 } }
			1 = { planet_event = { id = gigas_habitat_cap.4 days = 151 } }
		}
	}
}

gigas_habitat_cap_planet_pop_counting = {
	every_owned_pop = {
		prevprev = {
			change_variable = { which = owned_pops value = 1 }
		}
	}
}

gigas_habitat_cap_system_counting = {
	set_variable = { which = owned_systems value = 0 }
    every_system_within_border = {
        prev = { change_variable = { which = owned_systems value = 1 } }
    }
}

gigas_habitat_cap_calculator = {
	set_variable = { which = allowed_habitats value = 0 }
	if = {
		limit = {
			has_global_flag = giga_habitats_system_3
		}
		while = {
			limit = {
				check_variable = { which = owned_systems value > 3 }
			}
			change_variable = { which = owned_systems value = -3 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	else_if = {
		limit = {
			has_global_flag = giga_habitats_system_10		
		}
		while = {
			limit = {
				check_variable = { which = owned_systems value > 10 }
			}
			change_variable = { which = owned_systems value = -10 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	else_if = {
		limit = {
			has_global_flag = giga_habitats_system_25		
		}
		while = {
			limit = {
				check_variable = { which = owned_systems value > 25 }
			}
			change_variable = { which = owned_systems value = -25 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	else_if = {
		limit = {
			has_global_flag = giga_habitats_pop_25
		}
		while = {
			limit = {
				check_variable = { which = owned_pops value > 25 }
			}
			change_variable = { which = owned_pops value = -25 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	else_if = {
		limit = {
			has_global_flag = giga_habitats_pop_50
		}
		while = {
			limit = {
				check_variable = { which = owned_pops value > 50 }
			}
			change_variable = { which = owned_pops value = -50 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	else_if = {
		limit = {
			has_global_flag = giga_habitats_pop_100
		}
		while = {
			limit = {
				check_variable = { which = owned_pops value > 100 }
			}
			change_variable = { which = owned_pops value = -100 }
			change_variable = { which = allowed_habitats value = 1 }
		}
	}
	change_variable = { which = allowed_habitats value = 3 }
	gigas_habitat_cap_multipliers = yes
}

gigas_habitat_cap_multipliers = {
	if = {
		limit = {
			has_origin = origin_void_dwellers
			has_ascension_perk = ap_voidborn
		}
		multiply_variable = { which = allowed_habitats value = 2 }
	}
	else_if = {
		limit = {
			has_origin = origin_void_dwellers
			NOT = {
				has_ascension_perk = ap_voidborn
			}
		}
		multiply_variable = { which = allowed_habitats value = 1.5 }
	}
	else_if = {
		limit = {
			has_origin = origin_void_dwellers
			NOT = {
				has_ascension_perk = ap_voidborn
			}
		}
		multiply_variable = { which = allowed_habitats value = 0.5 }
	}
}